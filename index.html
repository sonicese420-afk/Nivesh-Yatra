<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nivesh Yatra ‚Äî Brokerage Demo</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#07111a; --card:#0d1a20; --accent:#16a085; --muted:#9aa6ad; --text:#e8f0f2; --glass: rgba(255,255,255,0.03);
    }
    html.light { --bg:#f2f6f8; --card:#ffffff; --accent:#12b886; --muted:#6b7785; --text:#0b1b23; --glass: rgba(0,0,0,0.03); }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#06121a);color:var(--text);font-family:Inter,system-ui,Arial;-webkit-font-smoothing:antialiased}
    .container{padding:18px 16px 120px;max-width:980px;margin:0 auto}
    .site-header{display:flex;align-items:center;justify-content:space-between;padding:14px;position:sticky;top:0;background:linear-gradient(90deg,var(--card),rgba(0,0,0,0.02));backdrop-filter:blur(4px);z-index:10;border-bottom-left-radius:10px;border-bottom-right-radius:10px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:var(--glass)}
    .brand-text .company-name{font-weight:700;font-size:18px}
    .brand-text .slogan{font-size:12px;color:var(--muted)}
    .header-actions .icon-btn{background:transparent;border:none;color:var(--text);font-size:18px;margin-left:8px;cursor:pointer}
    .card{background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.02));border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,0.35)}
    .card.row{display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:12px}
    .summary{display:flex;justify-content:space-between;align-items:center}
    .summary .label{font-size:12px;color:var(--muted);font-weight:600}
    .big{font-size:28px;font-weight:800;margin-top:6px}
    .muted{color:var(--muted);font-size:13px}
    .list{display:flex;flex-direction:column;gap:12px}
    .controls{display:flex;gap:10px;align-items:center}
    .controls .qty{width:64px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
    .btn{border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
    .title{font-size:16px}
    .price{font-size:18px;color:var(--text)}
    .panel-title{font-size:24px;margin:8px 0 14px}
    .bottom-nav{position:fixed;left:12px;right:12px;bottom:12px;background:linear-gradient(180deg,var(--card),rgba(0,0,0,0.02));border-radius:16px;display:flex;justify-content:space-around;padding:10px 12px;gap:10px;align-items:center;box-shadow:0 18px 30px rgba(0,0,0,0.45)}
    .bottom-nav .nav-btn{background:transparent;border:none;color:var(--muted);flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:6px;border-radius:10px;font-weight:700;cursor:pointer}
    .bottom-nav .nav-btn.active{background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);color:var(--text);box-shadow:inset 0 -2px 0 rgba(255,255,255,0.02)}
    #detailArea .card{padding:10px;margin-top:12px}
    #detailArea canvas{width:100% !important;height:260px !important;display:block;border-radius:8px}
    .hidden{display:none}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:140px;background:#111;padding:8px 16px;border-radius:20px;color:#fff;box-shadow:0 8px 18px rgba(0,0,0,0.5)}
    @media (min-width:900px){ .container{max-width:900px;margin:0 auto} .bottom-nav{left:24%;right:24%} }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 64 64" width="44" height="44" xmlns="http://www.w3.org/2000/svg" fill="none">
          <rect x="4" y="10" width="56" height="44" rx="6" fill="#ffffff10"/>
          <path d="M14 40 L28 20 L38 30 L50 14" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="brand-text">
        <div class="company-name">Nivesh Yatra</div>
        <div class="slogan">Turning dreams into Assets.</div>
      </div>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="icon-btn" title="Theme">üåì</button>
      <button id="notifBtn" class="icon-btn" title="Notifications">üîî</button>
    </div>
  </header>

  <main class="container">
    <section class="summary card">
      <div>
        <div class="label">MY ASSETS</div>
        <div id="totalAmount" class="big">‚Çπ0</div>
        <div id="oneDayChange" class="muted">1 Day Change: ‚Çπ0 (0%)</div>
        <div id="holdingsCount" class="muted" style="margin-top:6px;">Holdings: 0</div>
      </div>
      <div>
        <button id="toggleHide" class="btn ghost">üëÅ</button>
      </div>
    </section>

    <section id="stocksPanel" class="panel">
      <h2 class="panel-title">Buy Stocks</h2>
      <div id="stockList" class="list"></div>
    </section>

    <section id="fundsPanel" class="panel hidden">
      <h2 class="panel-title">Mutual Funds</h2>
      <div id="fundList" class="list"></div>
    </section>

    <section id="portfolioPanel" class="panel hidden">
      <h2 class="panel-title">Your Portfolio</h2>
      <div id="portfolioSummary" class="card small"></div>
      <div id="portfolioList" class="list"></div>
      <div id="detailArea"></div>
    </section>
  </main>

  <nav class="bottom-nav" role="navigation" aria-label="main">
    <button class="nav-btn active" data-target="stocksPanel">üìà<span>Stocks</span></button>
    <button class="nav-btn" data-target="fundsPanel">üìä<span>Funds</span></button>
    <button class="nav-btn" data-target="portfolioPanel">üßæ<span>Portfolio</span></button>
  </nav>

  <div id="toast" class="toast hidden"></div>

  <script>
  // Entire interactive app (single-file). Key: localStorage key = nv_portfolio_v5
  (function(){
    // ---------- demo price data ----------
    const stocks = {
      "Tata Motors": rnd(600,950),
      "Adani Green": rnd(820,1500),
      "Wipro": rnd(220,360),
      "MRF": rnd(90000,150000),
      "Reliance": rnd(1400,1800),
      "HDFC": rnd(1100,1600),
      "Affle 3i Ltd": rnd(100,220)
    };
    const funds = {
      "Edelweiss Nifty Midcap150 Momentum 50 Index Fund": rnd(80,160),
      "HDFC Mid Cap Fund": rnd(100,250),
      "HDFC Small Cap Fund": rnd(90,200),
      "Nippon India Large Cap Fund": rnd(90,180),
      "SBI Large Cap Fund": rnd(85,175),
      "Nippon India Growth Mid Cap Fund": rnd(100,210),
      "Nippon India Small Cap Fund": rnd(80,160),
      "HDFC Large Cap Fund": rnd(90,170)
    };

    // ---------- local storage ----------
    const KEY = 'nv_portfolio_v5';
    let portfolio = JSON.parse(localStorage.getItem(KEY) || '{"stocks":{},"funds":{},"cash":0}');
    function save(){ localStorage.setItem(KEY, JSON.stringify(portfolio)); }

    // ---------- elements ----------
    const stockList = qs('#stockList'), fundList = qs('#fundList'), portfolioList = qs('#portfolioList');
    const portfolioSummary = qs('#portfolioSummary'), detailArea = qs('#detailArea');
    const totalAmountEl = qs('#totalAmount'), oneDayChangeEl = qs('#oneDayChange'), holdingsCountEl = qs('#holdingsCount');
    const toastEl = qs('#toast');

    // nav
    const navBtns = document.querySelectorAll('.nav-btn');
    navBtns.forEach(b => b.addEventListener('click', navClick));
    function navClick(e){
      navBtns.forEach(x=>x.classList.remove('active'));
      e.currentTarget.classList.add('active');
      const target = e.currentTarget.dataset.target;
      document.querySelectorAll('.panel').forEach(p=>p.classList.add('hidden'));
      document.getElementById(target).classList.remove('hidden');
      if(target==='portfolioPanel') renderPortfolio();
    }

    // theme toggle
    qs('#themeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('light');
      localStorage.setItem('nv_theme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
    });
    if(localStorage.getItem('nv_theme') === 'light') document.documentElement.classList.add('light');

    // delegation events
    stockList.addEventListener('click', onStockClick);
    fundList.addEventListener('click', onFundClick);
    portfolioList.addEventListener('click', onPortfolioClick);

    // render lists
    function renderStocks(){
      stockList.innerHTML = '';
      Object.keys(stocks).forEach(name=>{
        const price = stocks[name];
        const row = el('div','card row');
        row.innerHTML = \`
          <div>
            <div class="title">\${name}</div>
            <div class="price">‚Çπ\${num(price)}</div>
          </div>
          <div class="controls">
            <input class="qty" type="number" min="1" value="1" />
            <button class="btn primary buy" data-name="\${escape(name)}">Buy</button>
          </div>\`;
        stockList.appendChild(row);
      });
    }
    function renderFunds(){
      fundList.innerHTML = '';
      Object.keys(funds).forEach(name=>{
        const price = funds[name];
        const row = el('div','card row');
        row.innerHTML = \`
          <div style="max-width:68%">
            <div class="title">\${name}</div>
            <div class="price">‚Çπ\${num(price)}</div>
          </div>
          <div class="controls">
            <input class="qty" type="number" min="1" value="1" />
            <button class="btn primary addfund" data-name="\${escape(name)}">Add</button>
          </div>\`;
        fundList.appendChild(row);
      });
    }

    // events
    function onStockClick(e){
      const btn = e.target.closest('.buy'); if(!btn) return;
      const name = unescape(btn.dataset.name), qtyEl = btn.parentElement.querySelector('.qty');
      const qty = Math.max(1, parseInt(qtyEl.value||1,10)); buyStock(name,qty);
    }
    function onFundClick(e){
      const btn = e.target.closest('.addfund'); if(!btn) return;
      const name = unescape(btn.dataset.name), qtyEl = btn.parentElement.querySelector('.qty');
      const qty = Math.max(1, parseInt(qtyEl.value||1,10)); buyFund(name,qty);
    }
    function onPortfolioClick(e){
      const sellBtn = e.target.closest('.sell'), redeemBtn = e.target.closest('.redeem'), detailsBtn = e.target.closest('.details');
      if(sellBtn){ sellStock(unescape(sellBtn.dataset.name)); }
      else if(redeemBtn){ redeemFund(unescape(redeemBtn.dataset.name)); }
      else if(detailsBtn){ showDetailsAndChart(unescape(detailsBtn.dataset.name)); }
    }

    // buy/sell
    function buyStock(name, qty){
      const price = stocks[name] || 0, prev = portfolio.stocks[name] || {qty:0, avg:0};
      const newQty = prev.qty + qty;
      const newAvg = newQty ? ((prev.qty*prev.avg) + qty*price)/newQty : price;
      portfolio.stocks[name] = { qty: newQty, avg: +newAvg.toFixed(2) };
      save(); renderPortfolio(); showToast(\`Bought \${qty} √ó \${name}\`);
    }
    function buyFund(name, units){
      const price = funds[name] || 0, prev = portfolio.funds[name] || {units:0, avg:0};
      const newUnits = prev.units + units;
      const newAvg = newUnits ? ((prev.units*prev.avg) + units*price)/newUnits : price;
      portfolio.funds[name] = { units: newUnits, avg: +newAvg.toFixed(2) };
      save(); renderPortfolio(); showToast(\`Added \${units} unit(s) of \${name}\`);
    }
    function sellStock(name){
      if(!portfolio.stocks[name]) return;
      portfolio.stocks[name].qty = Math.max(0, portfolio.stocks[name].qty - 1);
      if(portfolio.stocks[name].qty === 0) delete portfolio.stocks[name];
      save(); renderPortfolio(); showToast('Sold 1 √ó ' + name);
    }
    function redeemFund(name){
      if(!portfolio.funds[name]) return;
      portfolio.funds[name].units = Math.max(0, portfolio.funds[name].units - 1);
      if(portfolio.funds[name].units === 0) delete portfolio.funds[name];
      save(); renderPortfolio(); showToast('Redeemed 1 unit of ' + name);
    }

    // portfolio render & chart
    let chartInstance = null;
    function renderPortfolio(){
      portfolioList.innerHTML = ''; detailArea.innerHTML = '';
      let invested = 0, currentVal = 0, unitsCount = 0;
      Object.keys(portfolio.stocks).forEach(s=>{ const e = portfolio.stocks[s]; unitsCount += e.qty; invested += e.qty*e.avg; currentVal += e.qty*(stocks[s]||0); });
      Object.keys(portfolio.funds).forEach(f=>{ const e = portfolio.funds[f]; unitsCount += e.units; invested += e.units*e.avg; currentVal += e.units*(funds[f]||0); });
      const cash = portfolio.cash||0, total = currentVal + cash;
      totalAmountEl.textContent = '‚Çπ' + num(total);
      oneDayChangeEl.textContent = '1 Day Change: ‚Çπ' + (Math.random()*20-10).toFixed(2);
      holdingsCountEl.textContent = 'Holdings: ' + (Object.keys(portfolio.stocks).length + Object.keys(portfolio.funds).length) + ' items ‚Ä¢ ' + unitsCount + ' units';

      portfolioSummary.innerHTML = \`
        <div style="font-weight:800">Total: ‚Çπ\${num(total)}</div>
        <div class="muted" style="margin-top:6px">Invested: ‚Çπ\${num(invested)} ‚Ä¢ Cash: ‚Çπ\${num(cash)}</div>
        <div style="margin-top:8px"><button id="showPortfolioChart" class="btn ghost">Show 6-Month Portfolio Chart</button>
        <button id="seedBtn" class="btn ghost" style="margin-left:8px">Seed demo</button>
        <button id="resetBtn" class="btn ghost" style="margin-left:8px">Reset</button></div>\`;
      qs('#showPortfolioChart').addEventListener('click', renderPortfolioChart);
      qs('#seedBtn').addEventListener('click', seedDemo);
      qs('#resetBtn').addEventListener('click', resetDemo);

      if(Object.keys(portfolio.stocks).length===0 && Object.keys(portfolio.funds).length===0){
        portfolioList.innerHTML = '<div class="card">No holdings yet. Buy some stocks or add fund units to see details here.</div>'; return;
      }

      Object.keys(portfolio.stocks).forEach(s=>{
        const {qty,avg} = portfolio.stocks[s]; const cur = stocks[s]||0;
        const investedAmt = qty*avg; const curVal = qty*cur; const pl = curVal-investedAmt; const plPct = investedAmt? (pl/investedAmt*100).toFixed(2) : '0.00';
        const row = el('div','card row');
        row.innerHTML = \`
          <div style="max-width:66%">
            <div class="title">\${s}</div>
            <div class="muted">Qty: \${qty} ‚Ä¢ Avg: ‚Çπ\${num(avg)} ‚Ä¢ Cur: ‚Çπ\${num(cur)}</div>
            <div style="margin-top:6px">Invested ‚Çπ\${num(investedAmt)} ‚Ä¢ Value ‚Çπ\${num(curVal)} ‚Ä¢ <strong>\${pl>=0? '‚ñ≤':'‚ñº'} ‚Çπ\${num(Math.abs(pl))} (\${plPct}%)</strong></div>
          </div>
          <div class="controls">
            <button class="btn ghost sell" data-name="\${escape(s)}">Sell 1</button>
            <button class="btn ghost details" data-name="\${escape(s)}">Details</button>
          </div>\`;
        portfolioList.appendChild(row);
      });

      Object.keys(portfolio.funds).forEach(f=>{
        const {units,avg} = portfolio.funds[f]; const cur = funds[f]||0;
        const investedAmt = units*avg; const curVal = units*cur; const pl = curVal-investedAmt; const plPct = investedAmt? (pl/investedAmt*100).toFixed(2) : '0.00';
        const row = el('div','card row');
        row.innerHTML = \`
          <div style="max-width:66%">
            <div class="title">\${f}</div>
            <div class="muted">Units: \${units} ‚Ä¢ Avg: ‚Çπ\${num(avg)} ‚Ä¢ NAV: ‚Çπ\${num(cur)}</div>
            <div style="margin-top:6px">Invested ‚Çπ\${num(investedAmt)} ‚Ä¢ Value ‚Çπ\${num(curVal)} ‚Ä¢ <strong>\${pl>=0? '‚ñ≤':'‚ñº'} ‚Çπ\${num(Math.abs(pl))} (\${plPct}%)</strong></div>
          </div>
          <div class="controls">
            <button class="btn ghost redeem" data-name="\${escape(f)}">Redeem 1</button>
            <button class="btn ghost details" data-name="\${escape(f)}">Details</button>
          </div>\`;
        portfolioList.appendChild(row);
      });
    }

    // charts
    function renderPortfolioChart(){
      detailArea.innerHTML = '';
      const wrapper = el('div','card');
      wrapper.innerHTML = '<h4 style="margin:0 0 8px">Portfolio ‚Äî Last 6 months</h4><canvas id="historyChart"></canvas>';
      detailArea.appendChild(wrapper);
      const ctx = qs('#historyChart').getContext('2d');
      const holdings = buildSeries(); const labels = labelsLast6();
      const datasets = []; let idx=0;
      const palette = ['#16a085','#2f7ecf','#e76f51','#8d99ae','#f4a261','#7b2cbf','#06d6a0','#00b4d8'];
      const total = Array(6).fill(0);
      for(const k in holdings){
        const data = holdings[k].map(v=>+v.toFixed(2));
        data.forEach((v,i)=> total[i]+=v);
        datasets.push({label:k,data,borderColor:palette[idx%palette.length],backgroundColor:'transparent',tension:0.35,borderWidth:1.5,pointRadius:2});
        idx++;
      }
      datasets.push({label:'Total',data:total.map(v=>+v.toFixed(2)),borderColor:'#ffffff',backgroundColor:'transparent',borderWidth:3.5,tension:0.3,pointRadius:3});
      if(chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx,{type:'line',data:{labels,datasets},options:{maintainAspectRatio:false,responsive:true,plugins:{legend:{position:'bottom',labels:{boxWidth:10}}},scales:{y:{ticks:{callback:v=>'‚Çπ'+Number(v).toLocaleString()}}},interaction:{mode:'index',intersect:false}}});
    }

    function showDetailsAndChart(name){
      detailArea.innerHTML = '';
      const wrapper = el('div','card');
      wrapper.innerHTML = '<h4 style="margin:0 0 8px">'+name+' ‚Äî Last 6 months</h4><canvas id="historyChart"></canvas>';
      detailArea.appendChild(wrapper);
      const ctx = qs('#historyChart').getContext('2d');
      const curPrice = (stocks[name]||funds[name]||0);
      let qty = 0; if(portfolio.stocks[name]) qty = portfolio.stocks[name].qty||0; if(portfolio.funds[name]) qty = portfolio.funds[name].units||0;
      const priceSeries = genHistory(curPrice); const valueSeries = priceSeries.map(p => +(p*qty).toFixed(2));
      if(chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx,{type:'line',data:{labels:labelsLast6(),datasets:[{label:name+' value',data:valueSeries,borderColor:'#16a085',backgroundColor:'transparent',tension:0.3,borderWidth:2.5}]},options:{maintainAspectRatio:false,responsive:true,scales:{y:{ticks:{callback:v=>'‚Çπ'+Number(v).toLocaleString()}}}}});
    }

    function buildSeries(){
      const out = {}; Object.keys(portfolio.stocks).forEach(s=>{ const qty = portfolio.stocks[s].qty||0; const cur = stocks[s]||0; const series = genHistory(cur); out[s] = series.map(p => p * qty); });
      Object.keys(portfolio.funds).forEach(f=>{ const units = portfolio.funds[f].units||0; const cur = funds[f]||0; const series = genHistory(cur); out[f] = series.map(p => p * units); });
      return out;
    }

    function genHistory(current){ const arr = []; let v = current; for(let i=5;i>=0;i--){ const change = (Math.random()*10 - 5)/100; v = +(v / (1 + change)); arr.unshift(+v.toFixed(2)); } arr[arr.length-1] = +current.toFixed(2); return arr; }
    function labelsLast6(){ const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; const now = new Date(); const labels = []; for(let i=5;i>=0;i--){ const d = new Date(now.getFullYear(), now.getMonth()-i, 1); labels.push(months[d.getMonth()] + ' ' + d.getFullYear().toString().slice(-2)); } return labels; }

    // seed and reset helpers (UI visible)
    function seedDemo(){
      portfolio = {
        stocks: {
          "Tata Motors": {qty:3, avg:820.00},
          "Reliance": {qty:2, avg:1450.00},
          "Wipro": {qty:5, avg:300.00}
        },
        funds: {
          "HDFC Mid Cap Fund": {uni
